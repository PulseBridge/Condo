<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="15.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
    <PropertyGroup>
        <RestoreDependsOn>
            NpmInstall;
            BowerInstall;
            DotNetRestore;
            $(RestoreDependsOn);
        </RestoreDependsOn>
    </PropertyGroup>

    <ItemGroup>
        <DotNetRestorePaths Include="$(SrcRoot)" Condition=" Exists('$(SrcRoot)') " />
        <DotNetRestorePaths Include="$(TestRoot)" Condition=" Exists('$(TestRoot)') " />

        <NpmInstallPaths Include="$(RepositoryRoot)/**/package.json" />
        <BowerInstallPaths Include="$(RepositoryRoot)/**/bower.json" />
        <GulpPaths Include="$(RepositoryRoot)/**/gulpfile.*" />
        <GruntPaths Include="$(RepositoryRoot)/**/gruntfile.*" />

        <DotNetPaths Include="$(SrcRoot)/**/project.json" />
        <DotNetPaths Include="$(TestRoot)/**/project.json" />
    </ItemGroup>

    <Target Name="Restore" DependsOnTargets="$(RestoreDependsOn)" BeforeTargets="Prepare" />

    <Target Name="DotNetRestore" Condition=" '$(DotNetRestore)' != 'skip' ">
      <Exec Command="dotnet restore @(RestorePaths, ' ') $(DOTNET_RESTORE_OPTIONS)"
            WorkingDirectory="%(DotNetRestorePaths.RootDir)%(DotNetRestorePaths.Directory)" />
    </Target>

    <Target Name="NpmInstall" Condition=" '$(NpmInstall)' != 'skip' ">
      <Exec Command="npm install $(NPM_INSTALL_OPTIONS)"
            WorkingDirectory="%(NpmInstallPaths.RootDir)%(NpmInstallPaths.Directory)" />
    </Target>

    <Target Name="BowerInstall" Condition=" '$(BowerInstall)' != 'skip' ">
      <Exec Command="bower install $(BOWER_INSTALL_OPTIONS)"
            WorkingDirectory="%(NpmInstallPaths.RootDir)%(BowerInstallPaths.Directory)" />
    </Target>
</Project>