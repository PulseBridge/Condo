<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="15.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <PropertyGroup>
    <UnityPublishOptions Condition=" $(UNITY_PUBLISH_OPTIONS) != '' ">$(UNITY_PUBLISH_OPTIONS)</UnityPublishOptions>
  </PropertyGroup>

  <Target Name="UnityPublish" Condition=" $(UnityPublish) ">
    <Exec Command="xvfb-run --auto-servernum --server-args='-screen 0 640x480x24' &quot;$(UnityPath)&quot; -projectPath &quot;@(UnityProjectPath)&quot; -quit -batchmode -buildTarget %(UnityTargets) -customBuildTarget %(UnityTargets) -customBuildPath &quot;$(PublishArtifactsRoot)%(UnityTargets.ToLower())&quot; -customBuildOptions AcceptExternalModificationsToPlayer -executeMethod Build.PerformBuild -logFile $(UnityPublishOptions)"
        WorkingDirectory="@(UnityProjectPath)"
        IgnoreExitCode="true" />
  </Target>

  <PropertyGroup>
    <PublishDependsOn>
      $(PublishDependsOn);
      UnityPublish;
    </PublishDependsOn>
  </PropertyGroup>
</Project>
