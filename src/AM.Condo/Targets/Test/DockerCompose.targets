<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="15.0" xlmns="http://schemas.microsoft.com/developer/msbuild/2003">
	<Target Name="DockerComposeTest" Condition=" $(DockerRequired)">
		<!--
		Filter files from DockerRoot directory
		Match only docker-compose.$SOME_STRING.ci.y(a)ml
		Iterate and docker-compose up, docker-compose down all files
		-->
		<Exec Command="ls $(DockerRoot) | grep -i -E -o &quot;docker-compose\.[a-z0-9]*\.ci\.y(ml|aml)&quot; | while read -r path ; do
                        docker-compose -f &quot;$(DockerRoot)/$path&quot; up --remove-orphans --force-recreate --abort-on-container-exit --build --always-recreate-deps -V
                        docker-compose -f &quot;$(DockerRoot)/$path&quot; down
                        done" />
	</Target>
	<PropertyGroup>
		<AfterPublish>
			$(AfterPublish);
			DockerComposeTest;
		</AfterPublish>
	</PropertyGroup>
</Project>
