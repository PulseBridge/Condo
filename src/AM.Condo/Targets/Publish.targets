<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="15.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <Target Name="InstallPackages">
    <Exec Command="dotnet nuget push &quot;%(Packages.Identity)&quot; --source &quot;$(FeedArtifactsRoot)&quot;" />
  </Target>

  <Target Name="PublishPackages" Condition=" $(CI) AND '$(PackageFeedUri)' != '' ">
    <PropertyGroup>
      <NuGetPushOptions Condition=" '$(NuGetPushOptions)' == '' ">$(NUGET_PUSH_OPTIONS)</NuGetPushOptions>
      <NuGetPushOptions Condition=" '$(NuGetConfigPath)' != '' ">$(NuGetPushOptions) --config-file $(NuGetConfigPath)</NuGetPushOptions>
      <NuGetPushOptions Condition=" '$(PackageFeedUri)' != '' ">$(NuGetPushOptions) --source $(PackageFeedUri)</NuGetPushOptions>
      <NuGetPushOptions Condition=" '$(PackageFeedApiKey)' != '' ">$(NuGetPushOptions) --api-key $(PackageFeedApiKey)</NuGetPushOptions>
      <NuGetPushOptions Condition=" '$(PackageSymbolUri)' != '' ">$(NuGetPushOptions) --symbol-source $(PackageSymbolUri)</NuGetPushOptions>
      <NuGetPushOptions Condition=" '$(PackageSymbolApiKey)' != '' ">$(NuGetPushOptions) --symbol-api-key $(PackageSymbolApiKey)</NuGetPushOptions>
      <NuGetPushOptions Condition="$(PackageNoSymbols)">$(NuGetPushOptions) --no-symbols</NuGetPushOptions>
    </PropertyGroup>

    <Exec Command="dotnet nuget push &quot;%(Packages.Identity)&quot; $(NuGetPushOptions)" />
  </Target>

  <PropertyGroup>
    <PublishDependsOn>
      $(BeforePublish);
      InstallPackages;
      PublishPackages;
      $(PublishDependsOn);
      $(AfterPublish);
    </PublishDependsOn>
  </PropertyGroup>

  <Target Name="Publishing" DependsOnTargets="$(PublishDependsOn)" BeforeTargets="Publish" />
</Project>
